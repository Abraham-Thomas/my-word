# 浏览器的组成

## 先问个问题？

**当我们打开浏览器输入网址到页面显示内容，浏览器和服务端发生了什么事情？**

​	1、接受到用户输入的网址后，浏览器会开启一个线程来处理这个请求，对用户输入的URL地址进行分析判断，如果使HTTP协议就按照HTTP方式处理。

​	2、调用浏览器引擎中的对应方法，比如WebView中的loadUrl方法，分析并加载这个URL地址。

​	3、通过DNS解析获取该网站地址对应的IP地址，查询完成后连同浏览器的Cookie、userAgent等信息向网站目的IP发出GET请求。

​	4、进行HTTP协议会话，浏览器客户端向Web服务器发送报文。

​	5、进入网站后台上的Web服务器处理请求，如Apache、Tomcat、Node.js等服务器。

​	6、进入部署好的后端应用，如PHP、Java、JS、Python等后端程序，找到对应的请求处理逻辑，这期间可能会读取服务器缓存或查询数据库等。

​	7、服务器处理请求并返回响应报文，此时如果浏览器访问过该页面，缓存上有对应资源，会与服务器最后修改记录做对比，一致则返回304，否则返回200和对应的内容。

​	8、浏览器开始下载HTML文档（响应报头状态码为200时），或者从本地缓存读取文件内容（浏览器缓存有效或状态码为304时）。

​	9、浏览器根据下载接收到的HTML文件解析结构建立DOM，并根据HTML中的标记请求下载制定的MIME类型文件（如CSS、JS脚本等），同时设置缓存等内容。

​	10、页面开始渲染DOM，CSS根据规则解析并结合DOM文档树进行网页内容布局和绘制渲染，JS根据DOM API操作DOM，并读取浏览器缓存、执行实践绑定等，页面整个展示过程完成。

![浏览器组成结构](/images/浏览器组成结构图.png)

浏览器主要由以上七部分组成。

- **用户界面**包括浏览器中可见的地址输入框、浏览器前进返回按钮、打开书签、打开历史记录等用户可操作的功能选项。
- **浏览器引擎**可以在用户界面和渲染引擎之间传送指令或在客户端本地缓存中读写数据等，是浏览器中各个部分之间相互通信的核心。
- **渲染引擎**就是我们常说的浏览器**内核**，主要解析DOM文档和CSS规则并将内容排版到浏览器中显示有样式的界面，也可称之为排版引擎。
- **网络**功能模块则是浏览器开启网络线程发送请求或下载资源文件的模块，如DOM树解析过程中请求静态资源首先是通过浏览器中的网络模块发起的。
- **UI后端**用户绘制基本的浏览器控件
- **JavaScript引擎（解析器）**是浏览器解释和执行JS脚本的部分，如V8引擎。
- **数据持久化存储**则设计cookie、localStorage等一些客户端存储技术，通过浏览器引擎提供的API进行调用。



## 主流内核（渲染引擎）

Trident：如IE，360、搜狗；

Gecko：Netscape6及以上版本，Firefox、SeaMonkey；

Presto：Opera7及以上；

Webkit：Safari、Chrome。



## 主流JavaScript引擎

IE、Edge： Chakra

Chrome：V8（开启Node的大门）

Safari： Nitro

Firefox： SpiderMonkey（1.0-3.0）/ TraceMonkey（3.5-3.6）/ JaegerMonkey（4.0-）

Opera： Linear A（4.0-6.1）/ Linear B（7.0-9.2）/ Futhark（9.5-10.2）/ Carakan（10.5-）